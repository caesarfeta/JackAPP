function tserv(a){return angular.element(document.body).injector().get(a)}var app=angular.module("app",["ngRoute","appCtrl","appUI","angularFileUpload","minicolors"]),appUI=angular.module("appUI",[]),appCtrl=angular.module("appCtrl",[]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"html/explore.html",controller:"ExploreCtrl"})}]),appCtrl.controller("ExploreCtrl",["$scope",function(){}]),d3.custom={},d3.custom.barChart={},d3.custom.barChart.tags=[],d3.custom.barChart.init=function(a,b){var c={top:20,right:30,bottom:40,left:120},d=500-c.left-c.right,e=500-c.top-c.bottom,f=d3.scale.ordinal().domain(a.map(function(a){return a.name})).rangeRoundBands([0,e],.25),g=d3.scale.linear().domain([0,d3.max(a,function(a){return a.value})]).range([d,0]),h=(d3.svg.axis().scale(g).orient("bottom"),d3.svg.axis().scale(f).orient("left")),i=d3.select(".chart").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),j=f.rangeBand(),k=i.selectAll(".bar").data(a).enter().append("g");k.append("rect").attr("class","bar").attr("x",function(){return 0}).attr("y",function(a){return f(a.name)}).attr("width",function(a){return d-g(a.value)}).attr("height",j).on("click",function(a){var c=d3.select(this);c.classed("selected",!c.classed("selected"));var d=d3.custom.barChart.tags;if(c.classed("selected"))-1==d.indexOf(a.name)&&d.push(a.name);else{var e=d.indexOf(a.name);-1!=e&&d.splice(e,1)}void 0!=b&&b()}),k.append("text").attr("x",function(a){return d-g(a.value)+3}).attr("y",function(a){return f(a.name)+j-2}).text(function(a){return a.value}).attr("class","value"),i.append("g").attr("class","y axis").call(h).append("text").attr("transform","rotate(-90)").attr("x",-e/2).attr("y",-c.bottom).attr("dy",".71em").style("text-anchor","end")},appUI.directive("barChart",["$http",function(a){return{restrict:"E",replace:!0,template:'<svg class="chart"></svg>',link:function(b,c,d){function e(){a.get(d.src).then(function(a){d3.custom.barChart.init(a.data,f)})}var f=function(){var a=d3.custom.barChart.tags;b.$broadcast("chartClick",a)};e()}}}]),appUI.directive("chartForm",function(){return{restrict:"E",replace:!0,controller:function(a){function b(){return d3.range(~~(50*Math.random())+1).map(function(){return~~(1e3*Math.random())})}a.update=function(){a.data=b()}},template:'<div class="form">Height: {{ options.height }}<br /><input type="range" ng-model="options.height" min="100" max="800"/><br /><button ng-click="update()">Update Data</button><br />Hovered bar data: {{barValue}}</div>'}}),$(document).foundation(),appUI.directive("imageGrid",function(){return{restrict:"E",replace:!0,controller:function(a,b){a.data=null,a.total=null,a.shown=null,b.get("json/data/vortex.json").success(function(b){a.data=b;var c=0;for(var d in a.data.img)c++;a.shown=a.total=c,a.$apply()}),a.tags=[],a.$on("chartClick",function(b,c){a.tags=c,a.$apply()}),a.imgs=function(){if(null==a.data)return null;if(0==a.tags.length)return a.data.img;var b=a.data.img,c=[];for(var d in b){for(var e=b[d],f=e.tag,g=a.tags,h=0,i=0;i<f.length;i++)-1!=g.indexOf(f[i])&&(h+=1);h==g.length&&c.push(e)}return a.shown=c.length,c}},templateUrl:"ui/image-grid.ui.html"}}),app.directive("resize",function(a){return function(b){var c=angular.element(a);b.$watch(function(){return{h:c.height()}},function(a){b.windowHeight=a.h,b.windowWidth=a.w,b.resizeOffset=function(b){return{height:a.h-b+"px"}}},!0),c.bind("resize",function(){b.$apply()})}}),appUI.directive("reveal",function(){return{restrict:"E",link:function(a,b,c){var d="reveal-img";$("#"+d).length||$("body").append('<div id="'+d+'" class="reveal-modal" data-reveal></div>'),$(b).on("touchstart click",function(){$("#"+d+" img").length||$("#"+d).append("<img />"),$("#"+d+" img").attr("src",c.img),$("#"+d).foundation("reveal","open")})}}});